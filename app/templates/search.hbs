{{page-toolbar style="float:top" pageTitle="Search" isLayout=true}}


{{#paper-content class="md-padding"}}
<div class="layout-fill layout-align-start-center layout-column flex">
{{#paper-card as |card|}}
  <h1 class="center-text">
    Record Search
  </h1>
  {{#card.content}}
    {{#paper-form as |form|}}
      <div class="layout-row">
        {{form.input class="search-bar" label="Search" value=query required=true onChange=(action (mut query))}}
      </div>

    <div class="layout-row layout-align-center">
      {{#paper-button raised=true onClick=(action "toggleAdvancedSearch")}}
        {{#if showAdvancedSearch}}
          {{paper-icon 'keyboard arrow up'}}
        {{else}}
          {{paper-icon 'keyboard arrow down'}}
        {{/if}}
        Advanced Filters
      {{/paper-button}}
      {{#paper-button raised=true onClick=(action "search")}}Search{{/paper-button}}
    </div>

	{{#if showAdvancedSearch}}
    <div class="search-options">
      <div class="layout-row layout-align-center">
        <h3>Search Filters</h3>
      </div>
      <div class="layout-row layout-align-center">
        {{#paper-checkbox value=records onChange=(action (mut records))}}
          Include Records
        {{/paper-checkbox}}
        {{#paper-checkbox value=containers onChange=(action (mut containers))}}
          Include Containers
        {{/paper-checkbox}}
      </div>
      <div class="layout-row layout-align-center">
        <div class="layout-column search-options-column">
          {{#paper-select class="flex" label="Record State" options=states selected=selectedState onChange=(action "updateRecordState") as |recordState|}}
            {{recordState.name}}
          {{/paper-select}}
          {{#paper-select class="flex" label="Record Type" options=types selected=selectedType onChange=(action "updateRecordType") as |recordType|}}
            {{recordType.name}}
          {{/paper-select}}
          {{#paper-autocomplete
            class="flex"
            label="Retention Schedule"
            options=schedules searchField="code"
            onSelectionChange=(action "updateSchedule")
            selected=selectedSchedule
            noMatchesMessage="This Retention Schedule does not exits"
            as |retentionSchedule autocomplete|}}
            {{paper-autocomplete-highlight
              label=retentionSchedule.code
              searchText=autocomplete.searchText
            flags="i"}}
          {{/paper-autocomplete}}
        </div>
        <div class="layout-column search-options-column">
          {{paper-input class="flex" label="Classification" value=classification onChange=(action (mut classification))}}
          {{#paper-autocomplete
            class="flex"
            label="Location"
            options=locations searchField="code"
            onSelectionChange=(action "updateLocation")
            selected=selectedLocation
            noMatchesMessage="This Location does not exits"
          as |thisLocation autocomplete|}}
            {{paper-autocomplete-highlight
              label=thisLocation.code
              searchText=autocomplete.searchText
              flags="i"}}
          {{/paper-autocomplete}}
        </div>
          <div class="layout-column search-options-column">
            {{paper-input class="flex" label="Creation date" type="date" value=created onChange=(action (mut created))}}
            {{paper-input class="flex" label="Update date" type="date" value=updated onChange=(action (mut updated))}}
            {{paper-input class="flex" label="Destruction date" type="date" value=closed onChange=(action (mut closed))}}
          </div>
      </div>
    </div>
	{{/if}}
    {{/paper-form}}
  {{/card.content}}
{{/paper-card}}

  <div class="flex" >
    {{#paper-card as |card|}}
      {{#card.title as |title|}}
        {{#title.text as |text|}}
          {{#text.headline}}Search Results{{/text.headline}}
        {{/title.text}}
      {{/card.title}}
      {{#card.content}}

        {{#if currentlyLoading}}
          <div class="layout-fill layout-align-start-center layout-column">
            {{paper-progress-circular accent=true diameter=40}}
          </div>
        {{/if}}

        {{#paper-data-table selectable=true as |table|}}
          {{#table.head as |head|}}
            {{#head.column checkbox = true}}
              {{#paper-checkbox disabled=true onChange=null}}{{/paper-checkbox}}
            {{/head.column}}
            {{#head.column}}Type{{/head.column}}
            {{#head.column}}Number{{/head.column}}
            {{#head.column colspan=2}}Title{{/head.column}}
            {{#head.column}}Consignment Code{{/head.column}}
            {{#head.column}}Type{{/head.column}}
            {{#head.column}}Schedule{{/head.column}}
            {{#head.column}}State{{/head.column}}
            {{#head.column}}Location{{/head.column}}
            {{#head.column}}Classifications{{/head.column}}
            {{#head.column}}Created{{/head.column}}
            {{#head.column}}Updated{{/head.column}}
            {{#head.column}}Closed{{/head.column}}
          {{/table.head}}
          {{#table.body as |body|}}
          {{#unless currentlyLoading}}
            {{#each resultModel.content as |result|}}
              {{#if result.record}}
                  {{#body.row edit=true as |row|}}
                    {{#row.cell checkbox=true}}
                      {{checked-input record=result}}
                    {{/row.cell}}
                    {{#row.cell}}Record{{/row.cell}}
                    {{#row.cell}}{{result.record.number}}{{/row.cell}}
                    {{#row.cell}}{{result.record.title}}{{/row.cell}}
                    {{#row.cell}}{{result.record.consignmentCode}}{{/row.cell}}
                    {{#row.cell}}{{result.record.type.name}}{{/row.cell}}
                    {{#row.cell}}{{result.record.schedule.code}}{{/row.cell}}
                    {{#row.cell}}{{result.record.state.name}}{{/row.cell}}
                    {{#row.cell}}{{result.record.location.name}}{{/row.cell}}
                    {{#row.cell}}
                      {{#each result.record.classification as |class|}}
                        {{result.record.classification.name}}
                      {{/each}}
                    {{/row.cell}}
                    {{#row.cell}}{{moment-format result.record.createdAt 'll'}}{{/row.cell}}
                    {{#row.cell}}{{moment-format result.record.updatedAt 'll'}}{{/row.cell}}
                    {{#row.cell}}
                      {{#if result.record.closedAt}}
                        {{moment-format result.record.closedAt 'll'}}
                      {{/if}}
                    {{/row.cell}}
                  {{/body.row}}
              {{/if}}

              {{#if result.container}}
                  {{#body.row edit=true as |row|}}
                    {{#row.cell checkbox=true}}
                      {{checked-input container=result}}
                    {{/row.cell}}
                    {{#row.cell}}Container{{/row.cell}}
                    {{#row.cell}}{{result.container.number}}{{/row.cell}}
                    {{#row.cell}}{{result.container.title}}{{/row.cell}}
                    {{#row.cell}}{{result.container.consignmentCode}}{{/row.cell}}
                    {{#row.cell}}{{/row.cell}}
                    {{#row.cell}}{{/row.cell}}
                    {{#row.cell}}{{/row.cell}}
                    {{#row.cell}}{{/row.cell}}
                    {{#row.cell}}{{/row.cell}}
                    {{#row.cell}}{{moment-format result.container.createdAt 'll'}}{{/row.cell}}
                    {{#row.cell}}{{moment-format result.container.updatedAt 'll'}}{{/row.cell}}
                    {{#row.cell}}{{/row.cell}}
                  {{/body.row}}
            {{/if}}
            {{/each}}
          {{/unless}}
          {{/table.body}}
        {{/paper-data-table}}
        {{paper-data-table-pagination
          limit=pageSize
          limitOptions=limitOptions
          page=page
          pages=pages
          total=totalElements
          onChangePage=(action (mut page))
          onChangeLimit=(action (mut pageSize))
          onIncrementPage=(action 'incrementPage')
          onDecrementPage=(action 'decrementPage')}}
      {{/card.content}}
    {{/paper-card}}
  </div>

</div>

{{outlet}}
{{/paper-content}}